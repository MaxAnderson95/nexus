{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "title": "NEXUS Station Helm Chart Values",
  "description": "Schema for validating NEXUS Station Helm chart values",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "nameOverride": {
      "type": "string",
      "description": "Override the name of the chart"
    },
    "fullnameOverride": {
      "type": "string",
      "description": "Override the full name of the release"
    },
    "enableJSONLogging": {
      "type": "boolean",
      "description": "Enable JSON structured logging (sets LOGGING_STRUCTURED_FORMAT_CONSOLE=logstash)",
      "default": false
    },
    "managedBy": {
      "type": "string",
      "description": "Value for the app.kubernetes.io/managed-by label across all resources",
      "default": "Helm"
    },
    "imagePullSecrets": {
      "type": "array",
      "description": "Image pull secrets for all components",
      "items": {
        "type": "string"
      }
    },
    "otel": {
      "type": "object",
      "description": "OpenTelemetry configuration",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable manual OpenTelemetry configuration",
          "default": false
        },
        "sdkDisabled": {
          "type": "boolean",
          "description": "Disable the OpenTelemetry SDK entirely",
          "default": false
        },
        "endpoint": {
          "type": "string",
          "description": "OTLP endpoint URL (only used when enabled=true)",
          "default": "http://otel-collector:4317"
        },
        "protocol": {
          "type": "string",
          "description": "OTLP protocol: grpc or http/protobuf",
          "enum": ["grpc", "http/protobuf"],
          "default": "grpc"
        },
        "insecure": {
          "type": "boolean",
          "description": "Use insecure connection",
          "default": true
        }
      }
    },
    "chaos": {
      "type": "object",
      "description": "Chaos Engineering configuration",
      "additionalProperties": false,
      "properties": {
        "default": {
          "type": "string",
          "description": "Default chaos level applied to all services unless overridden",
          "enum": ["none", "low", "medium", "high"],
          "default": "none"
        },
        "cortex": {
          "type": "string",
          "description": "Chaos level override for Cortex",
          "enum": ["", "none", "low", "medium", "high"]
        },
        "docking": {
          "type": "string",
          "description": "Chaos level override for Docking service",
          "enum": ["", "none", "low", "medium", "high"]
        },
        "crew": {
          "type": "string",
          "description": "Chaos level override for Crew service",
          "enum": ["", "none", "low", "medium", "high"]
        },
        "lifeSupport": {
          "type": "string",
          "description": "Chaos level override for Life Support service",
          "enum": ["", "none", "low", "medium", "high"]
        },
        "power": {
          "type": "string",
          "description": "Chaos level override for Power service",
          "enum": ["", "none", "low", "medium", "high"]
        },
        "inventory": {
          "type": "string",
          "description": "Chaos level override for Inventory service",
          "enum": ["", "none", "low", "medium", "high"]
        }
      }
    },
    "cortex": {
      "$ref": "#/$defs/serviceConfig",
      "description": "Cortex BFF service configuration (includes frontend)"
    },
    "dockingService": {
      "$ref": "#/$defs/serviceConfig",
      "description": "Docking service configuration"
    },
    "crewService": {
      "$ref": "#/$defs/serviceConfig",
      "description": "Crew service configuration"
    },
    "lifeSupportService": {
      "$ref": "#/$defs/serviceConfig",
      "description": "Life Support service configuration"
    },
    "powerService": {
      "$ref": "#/$defs/serviceConfig",
      "description": "Power service configuration"
    },
    "inventoryService": {
      "$ref": "#/$defs/serviceConfig",
      "description": "Inventory service configuration"
    },
    "postgres": {
      "type": "object",
      "description": "PostgreSQL database configuration",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable deployment of PostgreSQL",
          "default": true
        },
        "image": {
          "$ref": "#/$defs/imageConfig"
        },
        "auth": {
          "type": "object",
          "description": "Authentication configuration",
          "additionalProperties": false,
          "properties": {
            "database": {
              "type": "string",
              "description": "Database name",
              "default": "nexus"
            },
            "username": {
              "type": "string",
              "description": "Database username",
              "default": "nexus"
            },
            "password": {
              "type": "string",
              "description": "Database password"
            }
          }
        },
        "service": {
          "type": "object",
          "description": "Service configuration",
          "additionalProperties": false,
          "properties": {
            "type": {
              "type": "string",
              "enum": ["ClusterIP", "NodePort", "LoadBalancer"],
              "default": "ClusterIP"
            },
            "port": {
              "type": "integer",
              "description": "Service port",
              "default": 5432
            }
          }
        },
        "persistence": {
          "type": "object",
          "description": "Persistence configuration",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable persistent storage",
              "default": true
            },
            "size": {
              "type": "string",
              "description": "Storage size",
              "pattern": "^[0-9]+(Gi|Mi|Ti)$",
              "default": "10Gi"
            },
            "storageClass": {
              "type": "string",
              "description": "Storage class name"
            }
          }
        },
        "resources": {
          "$ref": "#/$defs/resources"
        }
      }
    },
    "redis": {
      "type": "object",
      "description": "Redis cache configuration",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable deployment of Redis",
          "default": true
        },
        "image": {
          "$ref": "#/$defs/imageConfig"
        },
        "service": {
          "type": "object",
          "description": "Service configuration",
          "additionalProperties": false,
          "properties": {
            "type": {
              "type": "string",
              "enum": ["ClusterIP", "NodePort", "LoadBalancer"],
              "default": "ClusterIP"
            },
            "port": {
              "type": "integer",
              "description": "Service port",
              "default": 6379
            }
          }
        },
        "resources": {
          "$ref": "#/$defs/resources"
        }
      }
    },
    "loadGenerator": {
      "type": "object",
      "description": "Load generator configuration",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable deployment of the Load Generator",
          "default": false
        },
        "image": {
          "$ref": "#/$defs/imageConfig"
        },
        "users": {
          "type": "integer",
          "description": "Number of simulated users",
          "minimum": 1,
          "default": 10
        },
        "spawnRate": {
          "type": "integer",
          "description": "User spawn rate per second",
          "minimum": 1,
          "default": 1
        },
        "service": {
          "type": "object",
          "description": "Service configuration for the Locust web UI",
          "additionalProperties": false,
          "properties": {
            "type": {
              "type": "string",
              "enum": ["ClusterIP", "NodePort", "LoadBalancer"],
              "default": "ClusterIP"
            },
            "port": {
              "type": "integer",
              "description": "Service port",
              "default": 8089
            },
            "containerPort": {
              "type": "integer",
              "description": "Container port that Locust listens on",
              "default": 8089
            }
          }
        },
        "resources": {
          "$ref": "#/$defs/resources"
        }
      }
    }
  },
  "$defs": {
    "imageConfig": {
      "type": "object",
      "description": "Container image configuration",
      "additionalProperties": false,
      "properties": {
        "registry": {
          "type": "string",
          "description": "Container registry hostname"
        },
        "repository": {
          "type": "string",
          "description": "Repository path within the registry"
        },
        "pullPolicy": {
          "type": "string",
          "description": "Image pull policy",
          "enum": ["Always", "IfNotPresent", "Never"],
          "default": "Always"
        },
        "tag": {
          "type": "string",
          "description": "Image tag (defaults to chart appVersion if empty)"
        }
      }
    },
    "serviceConfig": {
      "type": "object",
      "description": "Application service configuration",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable deployment of the component",
          "default": true
        },
        "replicaCount": {
          "type": "integer",
          "description": "Number of pod replicas",
          "minimum": 0,
          "default": 1
        },
        "revisionHistoryLimit": {
          "type": "integer",
          "description": "Number of old ReplicaSets to retain for rollback",
          "minimum": 0,
          "default": 3
        },
        "strategy": {
          "$ref": "#/$defs/deploymentStrategy"
        },
        "image": {
          "$ref": "#/$defs/imageConfig"
        },
        "podAnnotations": {
          "type": "object",
          "description": "Additional annotations to add to pods",
          "additionalProperties": {
            "type": "string"
          }
        },
        "podLabels": {
          "type": "object",
          "description": "Additional labels to add to pods",
          "additionalProperties": {
            "type": "string"
          }
        },
        "service": {
          "type": "object",
          "description": "Service configuration",
          "additionalProperties": false,
          "properties": {
            "type": {
              "type": "string",
              "enum": ["ClusterIP", "NodePort", "LoadBalancer"],
              "default": "ClusterIP"
            },
            "port": {
              "type": "integer",
              "description": "Service port",
              "default": 80
            },
            "containerPort": {
              "type": "integer",
              "description": "Container port that the application listens on",
              "default": 8080
            }
          }
        },
        "resources": {
          "$ref": "#/$defs/resources"
        },
        "livenessProbe": {
          "$ref": "#/$defs/httpProbe",
          "description": "Liveness probe configuration"
        },
        "readinessProbe": {
          "$ref": "#/$defs/httpProbe",
          "description": "Readiness probe configuration"
        },
        "env": {
          "type": "array",
          "description": "Additional environment variables",
          "items": {
            "$ref": "#/$defs/envVar"
          }
        }
      }
    },
    "deploymentStrategy": {
      "type": "object",
      "description": "Deployment strategy configuration",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["RollingUpdate", "Recreate"],
          "default": "RollingUpdate"
        },
        "rollingUpdate": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "maxUnavailable": {
              "oneOf": [
                { "type": "integer", "minimum": 0 },
                { "type": "string", "pattern": "^[0-9]+%$" }
              ],
              "description": "Maximum number of unavailable pods during update"
            },
            "maxSurge": {
              "oneOf": [
                { "type": "integer", "minimum": 0 },
                { "type": "string", "pattern": "^[0-9]+%$" }
              ],
              "description": "Maximum number of pods that can be created above the desired number"
            }
          }
        }
      }
    },
    "resources": {
      "type": "object",
      "description": "Container resource configuration",
      "additionalProperties": false,
      "properties": {
        "requests": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "cpu": {
              "type": "string",
              "description": "CPU request",
              "pattern": "^[0-9]+m?$"
            },
            "memory": {
              "type": "string",
              "description": "Memory request",
              "pattern": "^[0-9]+(Ki|Mi|Gi)?$"
            }
          }
        },
        "limits": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "cpu": {
              "type": "string",
              "description": "CPU limit",
              "pattern": "^[0-9]+m?$"
            },
            "memory": {
              "type": "string",
              "description": "Memory limit",
              "pattern": "^[0-9]+(Ki|Mi|Gi)?$"
            }
          }
        }
      }
    },
    "httpProbe": {
      "type": "object",
      "description": "HTTP probe configuration",
      "additionalProperties": false,
      "properties": {
        "httpGet": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "path": {
              "type": "string",
              "description": "Path to probe"
            },
            "port": {
              "oneOf": [
                { "type": "integer" },
                { "type": "string" }
              ],
              "description": "Port to probe"
            },
            "scheme": {
              "type": "string",
              "enum": ["HTTP", "HTTPS"],
              "default": "HTTP"
            }
          }
        },
        "initialDelaySeconds": {
          "type": "integer",
          "description": "Initial delay before probing",
          "minimum": 0
        },
        "periodSeconds": {
          "type": "integer",
          "description": "Period between probes",
          "minimum": 1
        },
        "timeoutSeconds": {
          "type": "integer",
          "description": "Probe timeout",
          "minimum": 1
        },
        "successThreshold": {
          "type": "integer",
          "description": "Minimum consecutive successes",
          "minimum": 1
        },
        "failureThreshold": {
          "type": "integer",
          "description": "Minimum consecutive failures",
          "minimum": 1
        }
      }
    },
    "envVar": {
      "type": "object",
      "description": "Environment variable",
      "additionalProperties": false,
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Environment variable name"
        },
        "value": {
          "type": "string",
          "description": "Environment variable value"
        },
        "valueFrom": {
          "type": "object",
          "description": "Source for the environment variable value",
          "additionalProperties": false,
          "properties": {
            "secretKeyRef": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Secret name"
                },
                "key": {
                  "type": "string",
                  "description": "Key in the secret"
                }
              }
            },
            "configMapKeyRef": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "name": {
                  "type": "string",
                  "description": "ConfigMap name"
                },
                "key": {
                  "type": "string",
                  "description": "Key in the ConfigMap"
                }
              }
            },
            "fieldRef": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "fieldPath": {
                  "type": "string",
                  "description": "Field path"
                }
              }
            }
          }
        }
      }
    }
  }
}
